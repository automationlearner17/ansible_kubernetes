---

-  hosts: all
   become: true
   tasks:

    - name: update repo
      dnf: 
        update_cache : true

    - name: swapoff 
      command: swapoff -a
  
    - name: disbale SElinux
      command: setenforce 0
      when: ansible_facts.selinux.status == 'enabled'
 
    - name: set SElinux disbale  on reboot
      selinux:
        state: disabled
    - name: Ensure br_netfilter is enabled.
      modprobe:
        name: br_netfilter
        state: present 
 
    - name: ensure net.bridge.bridge-nf-call-ip6tables is set to 1
      sysctl: 
       name: net.bridge.bridge-nf-call-ip6tables
       value: 1
       state: present

    - name: ensure net.bridge.bridge-nf-call-iptables is set to 1
      sysctl:
       name: net.bridge.bridge-nf-call-iptables
       value: 1
       state: present

    - name: Install Docker
      dnf:
        name: docker
        state: present
        update_cache: true

    - name: Start Docker 
      service:
        name: docker 
        state: started


    - name: Add Kubernetes repo 
      yum_repository:
       name: kubernetes
       description: kubernetes repo
       baseurl:  https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
       gpgkey: https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
       gpgcheck: yes

    - name: Install Kubelet
      dnf: 
        name: kubelet-1.14.0
        state: present
        update_cache: yes

    - name: Install Kubeadm
      dnf:
        name: kubeadm-1.14.0
        state: present

    - name: Start Kubelet
      service:
        name: kubelet
        enabled: yes
        state: started




-  hosts: master
   become: yes
   tasks:
 

    - name: Install Kubectl
      dnf:
        name: kubectl-1.14.0
        state: present
        allow_downgrade: yes

       
   




